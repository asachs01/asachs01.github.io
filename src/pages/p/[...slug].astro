---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
	const posts = await getCollection('posts');
	const archives = await getCollection('archives');

	const allPosts = [...posts, ...archives].filter(p => !p.data.draft);

	return allPosts.map((post) => ({
		params: { slug: post.data.slug },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<BaseLayout title={`${post.data.title} - Aaron Sachs`} description={post.data.description}>
	<div class="stack gap-20">
		<main class="wrapper">
			<article class="post">
				<header class="post-header stack gap-2">
					<h1>{post.data.title}</h1>
					<div class="post-meta">
						<time datetime={post.data.date.toISOString()}>
							{post.data.date.toLocaleDateString('en-US', {
								year: 'numeric',
								month: 'long',
								day: 'numeric',
							})}
						</time>
						{post.data.categories && post.data.categories.length > 0 && (
							<span class="categories">
								{post.data.categories.join(', ')}
							</span>
						)}
					</div>
					{post.data.tags && post.data.tags.length > 0 && (
						<div class="tags">
							{post.data.tags.map((tag: string) => (
								<span class="tag">{tag}</span>
							))}
						</div>
					)}
				</header>
				<div class="content">
					<Content />
				</div>
			</article>
		</main>
	</div>
</BaseLayout>

<style>
	.post-header {
		margin-bottom: 2rem;
		padding-bottom: 1.5rem;
		border-bottom: 1px solid var(--gray-800);
	}

	.post-header h1 {
		font-size: var(--text-3xl);
		color: var(--gray-0);
	}

	.post-meta {
		display: flex;
		gap: 1rem;
		font-size: var(--text-sm);
		color: var(--gray-400);
	}

	.categories {
		text-transform: capitalize;
	}

	.tags {
		display: flex;
		flex-wrap: wrap;
		gap: 0.375rem;
	}

	.tag {
		font-size: 0.75rem;
		padding: 0.2rem 0.5rem;
		border-radius: 0.25rem;
		background-color: var(--gray-800);
		color: var(--gray-300);
		display: inline-block;
		transition: transform var(--theme-transition);
	}

	.tag:hover {
		transform: scale(1.05);
	}

	.content {
		line-height: 1.7;
		color: var(--gray-200);
	}

	.content :global(h1),
	.content :global(h2),
	.content :global(h3),
	.content :global(h4) {
		margin-top: 2rem;
		margin-bottom: 0.75rem;
	}

	.content :global(h2) {
		font-size: var(--text-2xl);
	}

	.content :global(h3) {
		font-size: var(--text-xl);
	}

	.content :global(p) {
		margin-bottom: 1rem;
	}

	.content :global(ul),
	.content :global(ol) {
		padding-left: 1.5rem;
		margin-bottom: 1rem;
	}

	.content :global(li) {
		margin-bottom: 0.5rem;
	}

	.content :global(pre) {
		padding: 1rem;
		border-radius: 0.375rem;
		overflow-x: auto;
		margin-bottom: 1rem;
		background-color: var(--gray-900) !important;
	}

	.content :global(code) {
		font-size: 0.9em;
	}

	.content :global(blockquote) {
		border-left: 3px solid var(--accent-regular);
		padding-left: 1rem;
		margin-left: 0;
		margin-bottom: 1rem;
		color: var(--gray-300);
	}

	.content :global(img) {
		border-radius: 0.25rem;
		margin-block: 1rem;
	}

	.content :global(a) {
		color: var(--link-color);
		text-decoration: none;
		background-image: var(--gradient-accent-text);
		background-size: 0% 2px;
		background-position: 0 100%;
		background-repeat: no-repeat;
		transition: background-size 0.3s ease;
	}

	.content :global(a:hover) {
		background-size: 100% 2px;
	}

	.content :global(iframe) {
		max-width: 100%;
		margin-block: 1rem;
	}
</style>
